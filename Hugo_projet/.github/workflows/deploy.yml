# =============================================================================
# L'AGENCE SAUVAGE - D√©ploiement automatique Hugo ‚Üí Vercel
# D√©clench√© √† chaque push sur main
# =============================================================================

name: Build & Deploy Hugo Blog

on:
  push:
    branches:
      - main
    paths:
      - 'content/**'
      - 'layouts/**'
      - 'static/**'
      - 'config/**'
      - 'hugo.toml'
  workflow_dispatch:  # Permet le d√©clenchement manuel

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. R√©cup√©rer le code
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # N√©cessaire pour .Lastmod bas√© sur git

      # 2. Installer Hugo
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      # 3. Build le site
      - name: Build Hugo site
        run: hugo --minify --gc

      # 4. V√©rifier le build
      - name: Check build output
        run: |
          echo "üìÅ Contenu du dossier public:"
          ls -la public/
          echo ""
          echo "üìÅ Contenu blog:"
          ls -la public/blog/ || echo "Pas de dossier blog"
          echo ""
          echo "üìä Statistiques:"
          echo "- Fichiers HTML: $(find public -name '*.html' | wc -l)"
          echo "- Taille totale: $(du -sh public | cut -f1)"

      # 5. Upload artifact pour Vercel
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: hugo-build
          path: public/
          retention-days: 1

  # Note: Vercel se connecte automatiquement √† GitHub
  # Ce workflow g√©n√®re juste les fichiers Hugo
  # Vercel d√©tecte le push et d√©ploie automatiquement
